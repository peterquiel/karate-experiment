/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Groovy project to get you started.
 * For more details take a look at the Groovy Quickstart chapter in the Gradle
 * User Manual available at https://docs.gradle.org/5.2.1/userguide/tutorial_groovy_projects.html
 */
buildscript {
    ext {
        karateVersion = '0.9.3'
    }
}
plugins {
    id 'scala'
    id 'groovy'
    id 'java'
}

repositories {
    mavenLocal()
    jcenter()
}

ext.junitPlatformVersion = '1.4.2'
ext.junitJupiterVersion = '5.4.2'
ext.jqwikVersion = '1.1.2'

dependencies {
    implementation 'org.scala-lang:scala-library:2.12.8'
    implementation 'org.codehaus.groovy:groovy-all:2.5.4'
    testCompile "com.intuit.karate:karate-junit5:${karateVersion}"
    testRuntime("org.junit.jupiter:junit-jupiter-engine:5.4.2")
    testCompile "com.intuit.karate:karate-apache:${karateVersion}"
    testCompile("com.intuit.karate:karate-gatling:${karateVersion}")
    testCompile("com.intuit.karate:karate-mock-servlet:${karateVersion}")
    testCompile("net.masterthought:cucumber-reporting:3.8.0")
    // aggregate jqwik dependency
    testCompile "net.jqwik:jqwik:${jqwikVersion}"

    testCompile"io.gatling:gatling-app:3.0.2"
    testCompile"io.gatling.highcharts:gatling-charts-highcharts:3.0.2"
    testCompile"com.intuit.karate:karate-gatling:${karateVersion}"
}

test {
    useJUnitPlatform()

    testLogging {
        events "passed", "skipped", "failed"
    }

    // pull karate options into the runtime
    systemProperty "karate.options", System.properties.getProperty("karate.options")
    // pull karate env into the runtime
    systemProperty "karate.env", System.properties.getProperty("karate.env")
    
    systemProperty "kick_my_ass", System.properties.kick_my_ass
    // ensure tests are always run
    outputs.upToDateWhen { false }
}

sourceSets {

    test {
        resources {
            srcDirs = ['src/test/resources','src/test/groovy','src/test/scala']
        }
    }
}

task gatlingRun(type: JavaExec) {
    group = 'Web Tests'
    description = 'Run Gatling Tests'

    new File("${buildDir}/reports/gatling").mkdirs()

    classpath = sourceSets.test.runtimeClasspath

    main = "io.gatling.app.Gatling"
    args = [
            '-s', 'com.github.peterquiel.karate.experiment.GatlingDemo',
            '-rf', "${buildDir}/reports/gatling"
    ]
    systemProperties System.properties
}